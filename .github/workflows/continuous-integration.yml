# Graphstorm CI - All tests executed sequentially

name: continuous-integration

on:
  push:
    branches:
      - main
      - ci_dev
  pull_request:
    

permissions:
  id-token: write
  contents: read

defaults:
  run:
    shell: bash

jobs:

#put lintcheck COMMAND here
  lint_check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    - name: Check if changes beside docs
      uses: dorny/paths-filter@v2
      id: changes
      with:
        filters: |
          other_than_docs:
            - '!(docs/**)**'
    - name: Lint Check on AWS Batch
      if: steps.changes.outputs.other_than_docs == 'true'
      uses: ./.github/actions
      with:
        job-type: CI-CPU
        job-name: Graphstorm-LintCheck
        command: FORCE_CUDA=1 python3 -m pip install -e '.[test]'  --no-build-isolation && python3 -m pip install pytest && sh ./tests/unit-tests/prepare_test_data.sh && export NCCL_IB_DISABLE=1; export NCCL_SHM_DISABLE=1; NCCL_NET=Socket NCCL_DEBUG=INFO python3 -m pytest ./tests/unit-tests -s

# put pytest COMMAND here
  # pytest:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - name: Checkout repository
  #     uses: actions/checkout@v3
  #   - name: Check if changes beside docs
  #     uses: dorny/paths-filter@v2
  #     id: changes
  #     with:
  #       filters: |
  #         other_than_docs:
  #           - '!(docs/**)**'
  #   - name: Pytest on AWS Batch
  #     if: steps.changes.outputs.other_than_docs == 'true'
  #     uses: ./.github/actions

    


