<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GraphStorm Advanced Usages &mdash; GraphStorm 0.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="graphstorm" href="../api/graphstorm.html" />
    <link rel="prev" title="Use Text as Node Features" href="language-models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GraphStorm
          </a>
              <div class="version">
                0.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/env-setup.html">Environment Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/quick-start.html">Standalone Mode Quick Start Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/own-data.html">Use Your Own Data Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">GraphStorm Configurations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Scale to Giant Graphs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scale/distributed.html">Use GraphStorm in a Distributed Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scale/sagemaker.html">Use GraphStorm on SageMaker</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="own-models.html">Use Your Own Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="language-models.html">Use Text as Node Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GraphStorm Advanced Usages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prevent-information-leakage-in-link-prediction">Prevent Information Leakage in Link Prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#speedup-link-prediction-training">Speedup Link Prediction Training</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#multiple-target-node-types-training">Multiple Target Node Types Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/graphstorm.html">graphstorm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/graphstorm.dataloading.html">graphstorm.dataloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/graphstorm.eval.html">graphstorm.eval</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/graphstorm.inference.html">graphstorm.inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/graphstorm.model.html">graphstorm.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/graphstorm.trainer.html">graphstorm.trainer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GraphStorm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GraphStorm Advanced Usages</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/advanced/advanced-usages.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="graphstorm-advanced-usages">
<span id="advanced-usages"></span><h1>GraphStorm Advanced Usages<a class="headerlink" href="#graphstorm-advanced-usages" title="Permalink to this heading"></a></h1>
<section id="prevent-information-leakage-in-link-prediction">
<h2>Prevent Information Leakage in Link Prediction<a class="headerlink" href="#prevent-information-leakage-in-link-prediction" title="Permalink to this heading"></a></h2>
<p>Link prediction is widely employed as a pre-training technique to generate high-quality entity representations applicable to diverse business applications. However, implementing a training loop for link prediction tasks needs to carefully handle the information leakage problems caused by 1) including target edges in message passing, and 2) including validation/test edges in message passing during training. (<a class="reference external" href="https://arxiv.org/pdf/2306.00899.pdf">This paper</a> provides more details.)</p>
<p>GraphStorm provides supports to avoid theses problems:</p>
<ul class="simple">
<li><p>To avoid including target edges in message passing, users need to set <code class="docutils literal notranslate"><span class="pre">exclude_training_targets</span></code> to <cite>True`</cite> and provide <code class="docutils literal notranslate"><span class="pre">reverse_edge_types_map</span></code> when launching link prediction training tasks. These two arguments tell GraphStorm to exclude the training target edges and the corresponding reverse edges when doing message passing. More explanation of the two arguments can be found on the <a class="reference internal" href="../configuration/configuration-run.html#configurations-run"><span class="std std-ref">Training and Inference Configurations</span></a>.</p></li>
<li><p>To avoid including validation/test edges in message passing during model training, users need to mask validation edges and test edges with <code class="docutils literal notranslate"><span class="pre">val_mask</span></code> and <code class="docutils literal notranslate"><span class="pre">test_mask</span></code> respectively. Users also need to mask all the other edges with <code class="docutils literal notranslate"><span class="pre">train_mask</span></code>.</p></li>
</ul>
</section>
<section id="speedup-link-prediction-training">
<h2>Speedup Link Prediction Training<a class="headerlink" href="#speedup-link-prediction-training" title="Permalink to this heading"></a></h2>
<p>GraphStorm relies on <code class="docutils literal notranslate"><span class="pre">dgl.dataloading.MultiLayerNeighborSampler</span></code> and <code class="docutils literal notranslate"><span class="pre">train_mask</span></code> to avoid sampling validation and test edges during training. Basically, it only samples edges with <code class="docutils literal notranslate"><span class="pre">train_mask</span></code> set to be <cite>True</cite>. However, the implementation is not efficient. To speedup graph sampling during link prediction training, GraphStorm provides four link prediction dataloaders (i.e., <code class="docutils literal notranslate"><span class="pre">fast_uniform</span></code>, <code class="docutils literal notranslate"><span class="pre">fast_joint</span></code>, <code class="docutils literal notranslate"><span class="pre">fast_localuniform</span></code> and <code class="docutils literal notranslate"><span class="pre">fast_localjoint</span></code>) with more efficient implementation but less precise neighbor sampling behavior.</p>
<p>To be more specific, these dataloaders will do neighbor sampling regardless of any masks in the beginning, and later remove edges with  <code class="docutils literal notranslate"><span class="pre">val_mask</span></code> or <code class="docutils literal notranslate"><span class="pre">test_mask</span></code> set to be <cite>True</cite>. In theory, a sampled subgraph may have less neighbor nodes than expected as some of them would be removed. However, with a graph having hundreds of millions of edges (or more) and small validation and test sets, e.g., each with less than 10% edges, the impact is negligible.</p>
<p>With DGL 1.0.4, <code class="docutils literal notranslate"><span class="pre">fast_localuniform</span></code> dataloader can speedup 2.4X over <code class="docutils literal notranslate"><span class="pre">localuniform</span></code> dataloader on training a 2 layer RGCN on MAG dataset on four g5.48x instances.</p>
</section>
</section>
<section id="multiple-target-node-types-training">
<h1>Multiple Target Node Types Training<a class="headerlink" href="#multiple-target-node-types-training" title="Permalink to this heading"></a></h1>
<p>When training on a hetergenious graph, we often need to train a model by minimizing the objective function on more than one node type. GraphStorm provides supports to achieve this goal.</p>
<ul>
<li><p>Train on multiple node types: The users only need to edit the <code class="docutils literal notranslate"><span class="pre">target_ntype</span></code> in model config YAML file to minimize the objective function defined on mutiple target node types. For example, by setting <code class="docutils literal notranslate"><span class="pre">target_ntype</span></code> as following, we can jointly optimize the objective function defined on “movie” and “user” node types.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">target_ntype</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">movie</span>
<span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</pre></div>
</div>
<p>During evuation, the users can set a single node type for evaluation. For example, by setting <code class="docutils literal notranslate"><span class="pre">eval_target_ntype:</span>&#160; <span class="pre">movie</span></code>, we will only perform evaluation on “movie” node type.</p>
</li>
<li><p>Evaluate on single node type: During evuation, the users can set a single node type for evaluation. For example, by setting <code class="docutils literal notranslate"><span class="pre">eval_target_ntype:</span>&#160; <span class="pre">movie</span></code>, we will only perform evaluation on “movie” node type. Our current implementation only support evaluating on a single node type.</p></li>
<li><p>Per target node type decoder: The users may also want to use a different decoder on each node type, where the output dimension for each decoder maybe different. We can achieve this by setting <code class="docutils literal notranslate"><span class="pre">num_classes</span></code> in model config YAML file. For example, by setting <code class="docutils literal notranslate"><span class="pre">num_classes</span></code> as following, GraphStorm will create a decoder with output dimension as 3 for movie node type, and a decoder with output dimension as 7 for user node type.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">num_classes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">movie</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">7</span>
</pre></div>
</div>
</li>
<li><p>Reweighting on loss function: The users may also want to use a customized loss function reweighting on each node type, which can be achieved by setting <code class="docutils literal notranslate"><span class="pre">multilabel</span></code>, <code class="docutils literal notranslate"><span class="pre">multilabel_weights</span></code>, and <code class="docutils literal notranslate"><span class="pre">imbalance_class_weights</span></code>. Examples are illustrated as following. Our current implementation does not support different node types with different <code class="docutils literal notranslate"><span class="pre">multilabel</span></code> setting.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">multilabel</span><span class="p">:</span>
<span class="w">  </span><span class="nt">movie</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">multilabel_weights</span><span class="p">:</span>
<span class="w">  </span><span class="nt">movie</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0.1,0.2,0.3</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0.1,0.2,0.3,0.4,0.5,0.0</span>

<span class="nt">multilabel</span><span class="p">:</span>
<span class="w">  </span><span class="nt">movie</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">imbalance_class_weights</span><span class="p">:</span>
<span class="w">  </span><span class="nt">movie</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0.1,0.2,0.3</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0.1,0.2,0.3,0.4,0.5,0.0</span>
</pre></div>
</div>
</li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="language-models.html" class="btn btn-neutral float-left" title="Use Text as Node Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/graphstorm.html" class="btn btn-neutral float-right" title="graphstorm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, AGML team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>